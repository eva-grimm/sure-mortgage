<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Sure Mortgage</title>

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">

    <!-- Boostrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <!-- Devicons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/devicons/devicon@v2.15.1/devicon.min.css">

    <!-- Prism CSS -->
    <link rel="stylesheet" href="/css/prism.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/site.css">
</head>

<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container-fluid">
                <a class="navbar-brand text-accent" href="/index.html">
                    <img src="/img/Cadence-Eva-mark-transparent.png" width="30" alt="Cadence Eva Mark">
                    Sure Mortgage
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link text-accent" href="/index.html">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-accent" href="/app.html">The App</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-accent active" aria-current="page" href="/code.html">The Code</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-accent" href="https://github.com/eva-grimm/sure-mortgage">The
                                Repo</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-accent" href="https://cadence-eva.netlify.app/">About</a>
                        </li>
                        <li class="nav-item">
                            <!-- TO DO: Add link once blog is made -->
                            <a class="nav-link text-accent" href="#">Blog</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main class="container py-3">
        <div class="row">
            <div class="col-12 col-lg-8">
                <h2 class="border-bottom border-2 border-dark">The Code</h2>
                <pre class="line-numbers">
                    <code class="language-js">
                        function getTerms() {
                            cleanSlate()
                        
                            let loanAmountInput = document.getElementById('loan-amount').value;
                            let loanAmount = parseFloat(regex(loanAmountInput));
                        
                            let termMonthsInput = document.getElementById('term-months').value;
                            let termMonths = parseInt(regex(termMonthsInput));
                        
                            let interestRateInput = document.getElementById('interest-rate').value;
                            let interestRate = parseFloat(regex(interestRateInput));
                        
                            isNaN(loanAmount) || isNaN(termMonths) || isNaN(interestRate) ? '' : calculate(loanAmount, termMonths, interestRate)
                        }
                        
                        function cleanSlate() {
                            const paymentBreakdownDiv = document.getElementById('payment-breakdown-div');
                            const paymentBreakdownTable = document.getElementById('payment-breakdown-table');
                            const paymentAmount = document.getElementById('payment-amount');
                            const totalPrincipalPaid = document.getElementById('total-principal');
                            const totalInterestPaid = document.getElementById('total-interest');
                            const totalCost = document.getElementById('total-cost');
                            const alert = document.getElementById('alert');
                            const errorMessage = document.getElementById('error-message');
                            const results = document.getElementById('results');
                        
                            alert.classList.add('d-none');
                            results.classList.add('d-none');
                            paymentBreakdownDiv.classList.add('d-none')
                            paymentBreakdownTable.innerText = '';
                            errorMessage.innerHTML = '';
                            paymentAmount.innerText = '';
                            totalPrincipalPaid.innerText = '';
                            totalInterestPaid.innerText = '';
                            totalCost.innerText = '';
                        }
                        
                        function regex(input) {
                            const pattern = /[^0-9]/g;
                            let numbers = input.replace(pattern, '')
                            if (numbers == '') {
                                const outputColumn = document.getElementById('output-column');
                                const errorMessage = document.getElementById('error-message');
                                const alert = document.getElementById('alert');
                        
                                outputColumn.querySelector('img').classList.add('d-none');
                                alert.classList.remove('d-none')
                                outputColumn.querySelector('.alert').classList.add('alert-danger')
                                errorMessage.innerHTML += `'${input}' is not a valid entry&lt;br>`;
                                return false;
                            } else return numbers;
                        }
                        
                        function calculate(loanAmount, termMonths, interestRate) {
                            let balance = loanAmount;
                            let totalInterest = 0;
                            let totalMonthlyPayment = loanAmount * ((interestRate / 1200) / (1 - (1 + interestRate / 1200) ** -(termMonths)))
                        
                            for (i = 1; i &lt;= termMonths; i++) {
                                let interestPayment = balance * (interestRate / 1200);
                                totalInterest += interestPayment;
                        
                                let principalPayment = totalMonthlyPayment - interestPayment;
                                balance -= principalPayment;
                                populateTable(i, totalMonthlyPayment, principalPayment, interestPayment, totalInterest, balance);
                            }
                            displayTotals(loanAmount, totalMonthlyPayment, totalInterest)
                        }
                        
                        function populateTable(month, payment, principal, interest, totalInterest, balance) {
                            const paymentBreakdownTable = document.getElementById('payment-breakdown-table')
                            const tableRowTemplate = document.getElementById('table-row-template');
                        
                            let tableRowCopy = tableRowTemplate.content.cloneNode(true);
                            tableRowCopy.querySelector('[data-id="month"]').innerText = month;
                            tableRowCopy.querySelector('[data-id="payment"]').innerText = convertToUSD(payment);
                            tableRowCopy.querySelector('[data-id="principal"]').innerText = convertToUSD(principal);
                            tableRowCopy.querySelector('[data-id="interest"]').innerText = convertToUSD(interest);
                            tableRowCopy.querySelector('[data-id="totalInterest"]').innerText = convertToUSD(totalInterest);
                            if (balance &lt; 0) tableRowCopy.querySelector('[data-id="balance"]').innerText = '$0.00';
                            else tableRowCopy.querySelector('[data-id="balance"]').innerText = convertToUSD(balance);
                        
                            paymentBreakdownTable.appendChild(tableRowCopy);
                        }
                        
                        function displayTotals(loanAmount, totalMonthlyPayment, totalInterest) {
                            const outputColumn = document.getElementById('output-column');
                            const results = document.getElementById('results');
                            const paymentBreakdownDiv = document.getElementById('payment-breakdown-div');
                            const paymentAmount = document.getElementById('payment-amount');
                            const totalPrincipalPaid = document.getElementById('total-principal');
                            const totalInterestPaid = document.getElementById('total-interest');
                            const totalCost = document.getElementById('total-cost');
                        
                            // hide app logo, show results and table
                            outputColumn.querySelector('img').classList.add('d-none');
                            results.classList.remove('d-none')
                            paymentBreakdownDiv.classList.remove('d-none')
                        
                            paymentAmount.innerText = convertToUSD(totalMonthlyPayment);
                            totalPrincipalPaid.innerText = convertToUSD(loanAmount);
                            totalInterestPaid.innerText = convertToUSD(totalInterest);
                            totalCost.innerText = convertToUSD(loanAmount + totalInterest);
                        }
                        
                        function convertToUSD(number) {
                            const USDollar = new Intl.NumberFormat('en-US', {
                                style: 'currency',
                                currency: 'USD',
                            });
                            let numberToNearestCent = number.toFixed(2);
                            return USDollar.format(numberToNearestCent)
                        }
                    </code>
                </pre>
            </div>
            <div class="col-12 col-lg-4">
                <p>
                    This applet is a loan calculator that takes the basic terms of a loan and provides the overall costs
                    of it and a breakdown of each month's payment. It is structured in seven functions, and its HTML
                    includes one template and an eventListener. The eventListener calls the entry point, getTerms().
                    Let's dive in.
                </p>

                <h5>The Template</h5>
                <p>
                    The applet uses one template, table-row-template. This template is a simple 'tr' tag encasing
                    mulitple 'td' tags with data-ids matching the properties of loan elements and is used by
                    populateTable() to build the loan breakdown table at the bottom of the applet page.
                </p>

                <h5>The Event Listener</h5>
                <p>
                    The applet's HTML has an event listener embedded using a script tag. The script gets the form used
                    to obtain the loan terms, and it listens for a submit event. Once triggered, it prevents the page
                    from reloading and calls getTerms().
                </p>

                <h5>getTerms()</h5>
                <p>
                    This function is the entry point of the applet and sets the stage for the applet to process the
                    provided loan terms. It begins by calling cleanSlate() to reset the HTML elements to their defaults
                    (other than the app logo being visible). It then retrieves the loan terms, runs passes each to
                    regex() as an argument, and parses the results as floats (except for term months, which is parsed as
                    an integer). It finally checks whether any of the provided terms is not a number and, if not, calls
                    calculate(), passing the loan amount, term in months, and interest rate as arguments.
                </p>

                <h5>cleanSlate()</h5>
                <p>
                    This function's purpose is to reset the HTML elements to their defaults. The sole exception is the
                    large app logo, which remains invisible. All elements in the HTML that are changed using DOM
                    manipulation during use of the applet are found and declared as constants, then those constants are
                    set te their default states.
                </p>

                <h5>regex()</h5>
                <p>
                    This function's purpose is verifying the user has provided a valid input, which it accepts as an
                    argument, 'input'. It begins by declaring a constant, global regex pattern that excludes anything
                    that is not the numbers 0-9, then it uses that pattern to remove all characters in input that do not
                    match the pattern.
                </p>
                <p>
                    Once the pattern is run, the function checks if input is now a blank string. If so, it finds the
                    HTML elements it needs to display an error message and declares them as constants. It then displays
                    an error message that explains the input data is bad, and which inputs are at issue.
                </p>
                <p>
                    If the input is blank after excluding non-numbers, then the function returns a boolean of false.
                    Otherwise, it returns the processed input.
                </p>

                <h5>calculate()</h5>
                <p>
                    This function's purpose is to calculate the monthly loan payment and the breakdown of each month's
                    loan payment. It accepts as parameters the loan terms: the loan amount, the loan term, and the
                    interest rate. It begins by declaring a variable, 'balance', and sets its value to the loan amount
                    (these are equivalent at the beginning of the loan). It then declares 'totalInterest' as 0, which
                    will be used to keep a running tally of interest payments to be displayed later.
                </p>
                <p>
                    The function then starts a for-loop with an index, 'i', equal to 1 and iterates the loop while the
                    index is less than or equal to the months in the loan term. The loop begins by establishing that
                    months interest payment and adding that payment to totalInterest. It then determines the principal
                    payment and subtracts it from balance. Finally, it calls populateTable() and passes index, total
                    monthly payment, principal payment, interest payment, totalInterest, and balance as arguments.
                </p>
                <p>
                    Once the for-loop is done iterating through each month, the function calls displayTotals() and
                    passes the loan amount, total monthly payment, and total interest as arguments.
                </p>

                <h5>populateTable()</h5>
                <p>
                    This function's purpose is to generate a table that displays the breakdown of each monthly payment.
                    It accepts as parameters the elements that will go into each cell in the row. The function begins by
                    finding the table and the row template and declaring them as constants.
                </p>
                <p>
                    The function then clones the template and applies each of the parameters to their respective table
                    row cell. All parameters except month are formatted by passing the parameters as arguments to
                    convertToUSD(), and if balance is negative, then the string '$0.00' is applied to that table cell
                    instead. Once the clone is filled with the parameters, it is appended to the table.
                </p>

                <h5>displayTotals()</h5>
                <p>
                    This function's purpose is to place the last pieces of the loan in the applet HTML and make all the
                    loan elements generated through earlier functions visible to the user. The function begins by
                    finding each of the HTML elements it will be changing with DOM manipulation and declaring them as
                    constants.
                </p>
                <p>
                    Once the constants are declared, the function hides the large app logo (this is only necessary on
                    the first run of the applet) and makes the results and table visible. The function then passes the
                    total monthly payment, total principle, total interest, and total cost to convertToUSD() and places
                    the returned values into results.
                </p>

                <h5>convertToUSD()</h5>
                <p>
                    This function's purpose is to format the number passed to it as a parameter into USD (i.e., listed
                    in $ and rounded to the nearest cent). The function first declares the constant 'USDollar' with a
                    USD formatter. It then rounds number to two decimal points using the toFixed method with an argument
                    of 2. Finally, it passes the rounded number to the USDollar formatter and returns the outcome.
                </p>
            </div>
        </div>
    </main>

    <footer class="footer container-fluid py-3">
        <div class="container">
            <div class="row row-cols-1 row-cols-lg-3 text-center align-items-center gy-2">
                <div class="col text-lg-start">
                    &copy2023 Cadence Eva Custin
                </div>
                <div class="col">
                    <img src="img/Cadence-Eva-logo-transparent.png" width="300" alt="">
                </div>
                <div class="col text-lg-end">
                    <a class="text-decoration-none" href="https://www.linkedin.com/in/cadence-eva-custin/">
                        <i class="bi bi-linkedin social-icons"></i>
                    </a>
                    <a class="text-decoration-none" href="https://github.com/eva-grimm">
                        <i class="bi bi-github social-icons"></i>
                    </a>
                    <a class="text-decoration-none" href="mailto:eva.custin@gmail.com">
                        <i class="bi bi-envelope-at social-icons"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>

    <!-- Prisme JS -->
    <script src="/js/prism.js"></script>
    <script>
        Prism.plugins.NormalizeWhitespace.setDefaults({
            'remove-trailing': true,
            'remove-indent': true,
            'left-trim': true,
            'right-trim': true
        })
    </script>
</body>

</html>